name: Push

on:
  workflow_dispatch:
  push:
    branches: [ "test-ci" ]

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Init
      run: make tests-init

  tests:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - uses: actions/checkout@v3
      - name: Run acceptance tests
        run: make tests-a

  validate:
    runs-on: ubuntu-latest
    needs: build
    steps:
    - uses: actions/checkout@v3
    - name: Validate composer files
      run: make ci-validate
    - name: Validate php code style
      run: make ci-code-style-check-php


